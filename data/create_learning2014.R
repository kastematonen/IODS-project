################################################################################################################################

# Julia Nihtilä
# 2023_11_10
# week 2 data wrangling excercises: https://www.mv.helsinki.fi/home/kvehkala/JYTmooc/JYTOPKYS3-meta.txt

################################################################################################################################

library(GGally)
library(ggplot2)
library(dplyr)
library(tidyverse)

################################################################################################################################

# Read the full learning2014 data from http://www.helsinki.fi/~kvehkala/JYTmooc/JYTOPKYS3-data.txt into R (the separator is a tab ("\t") and the file includes a header) and explore the structure and dimensions of the data. Write short code comments describing the output of these explorations.

learning2014 <- read.table("http://www.helsinki.fi/~kvehkala/JYTmooc/JYTOPKYS3-data.txt", sep = "\t", header = T)
dim(learning2014) # 183  60
str(learning2014)
# 'data.frame':	183 obs. of  60 variables:
#   $ Aa      : int  3 2 4 4 3 4 4 3 2 3 ...
# $ Ab      : int  1 2 1 2 2 2 1 1 1 2 ...
# $ Ac      : int  2 2 1 3 2 1 2 2 2 1 ...
# $ Ad      : int  1 2 1 2 1 1 2 1 1 1 ...
# $ Ae      : int  1 1 1 1 2 1 1 1 1 1 ...
# $ Af      : int  1 1 1 1 1 1 1 1 1 2 ...
# $ ST01    : int  4 4 3 3 4 4 5 4 4 4 ...
# $ SU02    : int  2 2 1 3 2 3 2 2 1 2 ...
# $ D03     : int  4 4 4 4 5 5 4 4 5 4 ...
# $ ST04    : int  4 4 4 4 3 4 2 5 5 4 ...
# $ SU05    : int  2 4 2 3 4 3 2 4 2 4 ...
# $ D06     : int  4 2 3 4 4 5 3 3 4 4 ...
# $ D07     : int  4 3 4 4 4 5 4 4 5 4 ...
# $ SU08    : int  3 4 1 2 3 4 4 2 4 2 ...
# $ ST09    : int  3 4 3 3 4 4 2 4 4 4 ...
# $ SU10    : int  2 1 1 1 2 1 1 2 1 2 ...
# $ D11     : int  3 4 4 3 4 5 5 3 4 4 ...
# $ ST12    : int  3 1 4 3 2 3 2 4 4 4 ...
# $ SU13    : int  3 3 2 2 3 1 1 2 1 2 ...
# $ D14     : int  4 2 4 4 4 5 5 4 4 4 ...
# $ D15     : int  3 3 2 3 3 4 2 2 3 4 ...
# $ SU16    : int  2 4 3 2 3 2 3 3 4 4 ...
# $ ST17    : int  3 4 3 3 4 3 4 3 4 4 ...
# $ SU18    : int  2 2 1 1 1 2 1 2 1 2 ...
# $ D19     : int  4 3 4 3 4 4 4 4 5 4 ...
# $ ST20    : int  2 1 3 3 3 3 1 4 4 2 ...
# $ SU21    : int  3 2 2 3 2 4 1 3 2 4 ...
# $ D22     : int  3 2 4 3 3 5 4 2 4 4 ...
# $ D23     : int  2 3 3 3 3 4 3 2 4 4 ...
# $ SU24    : int  2 4 3 2 4 2 2 4 2 4 ...
# $ ST25    : int  4 2 4 3 4 4 1 4 4 4 ...
# $ SU26    : int  4 4 4 2 3 2 1 4 4 4 ...
# $ D27     : int  4 2 3 3 3 5 4 4 5 4 ...
# $ ST28    : int  4 2 5 3 5 4 1 4 5 2 ...
# $ SU29    : int  3 3 2 3 3 2 1 2 1 2 ...
# $ D30     : int  4 3 4 4 3 5 4 3 4 4 ...
# $ D31     : int  4 4 3 4 4 5 4 4 5 4 ...
# $ SU32    : int  3 5 5 3 4 3 4 4 3 4 ...
# $ Ca      : int  2 4 3 3 2 3 4 2 3 2 ...
# $ Cb      : int  4 4 5 4 4 5 5 4 5 4 ...
# $ Cc      : int  3 4 4 4 4 4 4 4 4 4 ...
# $ Cd      : int  4 5 4 4 3 4 4 5 5 5 ...
# $ Ce      : int  3 5 3 3 3 3 4 3 3 4 ...
# $ Cf      : int  2 3 4 4 3 4 5 3 3 4 ...
# $ Cg      : int  3 2 4 4 4 5 5 3 5 4 ...
# $ Ch      : int  4 4 2 3 4 4 3 3 5 4 ...
# $ Da      : int  3 4 1 2 3 3 2 2 4 1 ...
# $ Db      : int  4 3 4 4 4 5 4 4 2 4 ...
# $ Dc      : int  4 3 4 5 4 4 4 4 4 4 ...
# $ Dd      : int  5 4 1 2 4 4 5 3 5 2 ...
# $ De      : int  4 3 4 5 4 4 5 4 4 2 ...
# $ Df      : int  2 2 1 1 2 3 1 1 4 1 ...
# $ Dg      : int  4 3 3 5 5 4 4 4 5 1 ...
# $ Dh      : int  3 3 1 4 5 3 4 1 4 1 ...
# $ Di      : int  4 2 1 2 3 3 2 1 4 1 ...
# $ Dj      : int  4 4 5 5 3 5 4 5 2 4 ...
# $ Age     : int  53 55 49 53 49 38 50 37 37 42 ...
# $ Attitude: int  37 31 25 35 37 38 35 29 38 21 ...
# $ Points  : int  25 12 24 10 22 21 21 31 24 26 ...
# $ gender  : chr  "F" "M" "F" "M" ...

# 183 rows, 60 variables whose names copy-pasted above

################################################################################################################################

# Create an analysis dataset with the variables gender, age, attitude, deep, stra, surf and points by combining questions in the learning2014 data, as defined in the Exercise Set and also on the bottom part of the following page (only the top part of the page is in Finnish). http://www.helsinki.fi/~kvehkala/JYTmooc/JYTOPKYS2-meta.txt. Scale all combination variables to the original scales (by taking the mean). Exclude observations where the exam points variable is zero. (The data should then have 166 observations and 7 variables)

# make the missing columns and scale them
deep_questions <- c("D03", "D11", "D19", "D27", "D07", "D14", "D22", "D30","D06",  "D15", "D23", "D31")
learning2014$deep <- rowMeans(learning2014[, deep_questions])
surface_questions <- c("SU02","SU10","SU18","SU26", "SU05","SU13","SU21","SU29","SU08","SU16","SU24","SU32")
learning2014$surf <- rowMeans(learning2014[, surface_questions])
strategic_questions <- c("ST01","ST09","ST17","ST25","ST04","ST12","ST20","ST28")
learning2014$stra <- rowMeans(learning2014[, strategic_questions])

# i assume we want to scale this too
learning2014$attitude <- learning2014$Attitude / 10

# filter columns
learning2014_cols <- learning2014[,c("gender","Age","attitude", "deep", "stra", "surf", "Points")]

# exclude the ones with a zero as their score
learning2014_cols_nonzero <- learning2014_cols[learning2014_cols$Points > 0,]
dim(learning2014_cols_nonzero) # 166   7 -> ok

################################################################################################################################

# Set the working directory of your R session to the IODS Project folder (study how to do this with RStudio). Save the analysis dataset to the ‘data’ folder, using for example write_csv() function (readr package, part of tidyverse). You can name the data set for example as learning2014.csv. See ?write_csv for help or search the web for pointers and examples. Demonstrate that you can also read the data again by using read_csv().  (Use `str()` and `head()` to make sure that the structure of the data is correct).

# Set the working directory of your R session to the IODS Project folder
# Session > set working directory > Choose directory
# or with the command
# setwd("path/to/folder")

# save data
write_csv(learning2014_cols_nonzero, "./data/learning2014.csv")
# check that saving worked
data <- read_csv("./data/learning2014.csv")
str(data)
# spc_tbl_ [166 × 7] (S3: spec_tbl_df/tbl_df/tbl/data.frame)
# $ gender  : chr [1:166] "F" "M" "F" "M" ...
# $ Age     : num [1:166] 53 55 49 53 49 38 50 37 37 42 ...
# $ attitude: num [1:166] 3.7 3.1 2.5 3.5 3.7 3.8 3.5 2.9 3.8 2.1 ...
# $ deep    : num [1:166] 3.58 2.92 3.5 3.5 3.67 ...
# $ stra    : num [1:166] 3.38 2.75 3.62 3.12 3.62 ...
# $ surf    : num [1:166] 2.58 3.17 2.25 2.25 2.83 ...
# $ Points  : num [1:166] 25 12 24 10 22 21 21 31 24 26 ...
# - attr(*, "spec")=
#   .. cols(
#     ..   gender = col_character(),
#     ..   Age = col_double(),
#     ..   attitude = col_double(),
#     ..   deep = col_double(),
#     ..   stra = col_double(),
#     ..   surf = col_double(),
#     ..   Points = col_double()
#     .. )
# - attr(*, "problems")=<externalptr> 
head(data)
# # A tibble: 6 × 7
# gender   Age attitude  deep  stra  surf Points
# <chr>  <dbl>    <dbl> <dbl> <dbl> <dbl>  <dbl>
#   1 F         53      3.7  3.58  3.38  2.58     25
# 2 M         55      3.1  2.92  2.75  3.17     12
# 3 F         49      2.5  3.5   3.62  2.25     24
# 4 M         53      3.5  3.5   3.12  2.25     10
# 5 M         49      3.7  3.67  3.62  2.83     22
# 6 F         38      3.8  4.75  3.62  2.42     21
dim(data) # 166   7
# saving the data worke ok
